// Join - only listening for 1- and 2-tuples

  for( a,b <- x ; c,d <- x ){ linear!(*a,*c) } | x!(2,2) | x!!(1,1) | for( a,b <! x ){ peek!(*a,*b) }

/*
  Output:
$ kompile join.k --backend java --transition "match"
$ krun tests/comm2.join --search-final
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            linear
          </schan>
          <msg>
            1 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            32
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            SetItem ( 3 )
          </mlid>
        </send>
      </sends>
      <receives>
        <rec>
          <id>
            4
          </id>
          <length>
            1
          </length>
          <cont>
            peek ! ( * a , * b )
          </cont>
          <state>
            "collection"
          </state>
          <match>
            1
          </match>
          <type>
            2
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                3
              </lid>
              <msid>
                21
              </msid>
            </listen>
          </listens>
        </rec>
      </receives>
    </tuplespace>
    <reaction>
      <who>
        peek ! ( * a , * b )
      </who>
      <what>
        ""
      </what>
      <where>
        ""
      </where>
      <rid>
        4
      </rid>
      <rnum>
        0
      </rnum>
      <react>
        "collect"
      </react>
      <forg>
        .Set
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            linear
          </schan>
          <msg>
            1 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            34
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            peek
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            26
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        .RecCellBag
      </receives>
    </tuplespace>
    <reaction>
      <who>
        .
      </who>
      <what>
        .
      </what>
      <where>
        .
      </where>
      <rid>
        .
      </rid>
      <rnum>
        .
      </rnum>
      <react>
        .
      </react>
      <forg>
        .
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            linear
          </schan>
          <msg>
            1 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            36
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            peek
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            28
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        .RecCellBag
      </receives>
    </tuplespace>
    <reaction>
      <who>
        .
      </who>
      <what>
        .
      </what>
      <where>
        .
      </where>
      <rid>
        .
      </rid>
      <rnum>
        .
      </rnum>
      <react>
        .
      </react>
      <forg>
        .
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            linear
          </schan>
          <msg>
            1 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            37
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            peek
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            29
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        .RecCellBag
      </receives>
    </tuplespace>
    <reaction>
      <who>
        .
      </who>
      <what>
        .
      </what>
      <where>
        .
      </where>
      <rid>
        .
      </rid>
      <rnum>
        .
      </rnum>
      <react>
        .
      </react>
      <forg>
        .
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            linear
          </schan>
          <msg>
            2 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            31
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            SetItem ( 3 )
          </mlid>
        </send>
      </sends>
      <receives>
        <rec>
          <id>
            4
          </id>
          <length>
            1
          </length>
          <cont>
            peek ! ( * a , * b )
          </cont>
          <state>
            "collection"
          </state>
          <match>
            1
          </match>
          <type>
            2
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                3
              </lid>
              <msid>
                21
              </msid>
            </listen>
          </listens>
        </rec>
      </receives>
    </tuplespace>
    <reaction>
      <who>
        peek ! ( * a , * b )
      </who>
      <what>
        ""
      </what>
      <where>
        ""
      </where>
      <rid>
        4
      </rid>
      <rnum>
        0
      </rnum>
      <react>
        "collect"
      </react>
      <forg>
        .Set
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            linear
          </schan>
          <msg>
            2 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            33
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            peek
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            26
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        .RecCellBag
      </receives>
    </tuplespace>
    <reaction>
      <who>
        .
      </who>
      <what>
        .
      </what>
      <where>
        .
      </where>
      <rid>
        .
      </rid>
      <rnum>
        .
      </rnum>
      <react>
        .
      </react>
      <forg>
        .
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            linear
          </schan>
          <msg>
            2 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            35
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            peek
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            27
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        .RecCellBag
      </receives>
    </tuplespace>
    <reaction>
      <who>
        .
      </who>
      <what>
        .
      </what>
      <where>
        .
      </where>
      <rid>
        .
      </rid>
      <rnum>
        .
      </rnum>
      <react>
        .
      </react>
      <forg>
        .
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            linear
          </schan>
          <msg>
            2 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            38
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            peek
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            30
          </sid>
          <mlid>
            .Set
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        .RecCellBag
      </receives>
    </tuplespace>
    <reaction>
      <who>
        .
      </who>
      <what>
        .
      </what>
      <where>
        .
      </where>
      <rid>
        .
      </rid>
      <rnum>
        .
      </rnum>
      <react>
        .
      </react>
      <forg>
        .
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            SetItem ( 3 )
            SetItem ( 24 )
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            16
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        <rec>
          <id>
            4
          </id>
          <length>
            1
          </length>
          <cont>
            peek ! ( * a , * b )
          </cont>
          <state>
            "collection"
          </state>
          <match>
            1
          </match>
          <type>
            2
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                3
              </lid>
              <msid>
                21
              </msid>
            </listen>
          </listens>
        </rec> <rec>
          <id>
            10
          </id>
          <length>
            2
          </length>
          <cont>
            linear ! ( * a , * c )
          </cont>
          <state>
            ""
          </state>
          <match>
            1
          </match>
          <type>
            0
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                24
              </lid>
              <msid>
                21
              </msid>
            </listen> <listen>
              <chan>
                x
              </chan>
              <vars>
                c , d
              </vars>
              <num>
                2
              </num>
              <lid>
                25
              </lid>
              <msid>
                ""
              </msid>
            </listen>
          </listens>
        </rec>
      </receives>
    </tuplespace>
    <reaction>
      <who>
        peek ! ( * a , * b )
      </who>
      <what>
        ""
      </what>
      <where>
        ""
      </where>
      <rid>
        4
      </rid>
      <rnum>
        0
      </rnum>
      <react>
        "collect"
      </react>
      <forg>
        .Set
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            SetItem ( 3 )
            SetItem ( 25 )
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            16
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        <rec>
          <id>
            4
          </id>
          <length>
            1
          </length>
          <cont>
            peek ! ( * a , * b )
          </cont>
          <state>
            "collection"
          </state>
          <match>
            1
          </match>
          <type>
            2
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                3
              </lid>
              <msid>
                21
              </msid>
            </listen>
          </listens>
        </rec> <rec>
          <id>
            10
          </id>
          <length>
            2
          </length>
          <cont>
            linear ! ( * a , * c )
          </cont>
          <state>
            ""
          </state>
          <match>
            1
          </match>
          <type>
            0
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                24
              </lid>
              <msid>
                ""
              </msid>
            </listen> <listen>
              <chan>
                x
              </chan>
              <vars>
                c , d
              </vars>
              <num>
                2
              </num>
              <lid>
                25
              </lid>
              <msid>
                21
              </msid>
            </listen>
          </listens>
        </rec>
      </receives>
    </tuplespace>
    <reaction>
      <who>
        peek ! ( * a , * b )
      </who>
      <what>
        ""
      </what>
      <where>
        ""
      </where>
      <rid>
        4
      </rid>
      <rnum>
        0
      </rnum>
      <react>
        "collect"
      </react>
      <forg>
        .Set
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            SetItem ( 3 )
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            16
          </sid>
          <mlid>
            .Set
          </mlid>
        </send>
      </sends>
      <receives>
        <rec>
          <id>
            4
          </id>
          <length>
            1
          </length>
          <cont>
            peek ! ( * a , * b )
          </cont>
          <state>
            "collection"
          </state>
          <match>
            1
          </match>
          <type>
            2
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                3
              </lid>
              <msid>
                21
              </msid>
            </listen>
          </listens>
        </rec> <rec>
          <id>
            10
          </id>
          <length>
            2
          </length>
          <cont>
            linear ! ( * a , * c )
          </cont>
          <state>
            ""
          </state>
          <match>
            0
          </match>
          <type>
            0
          </type>
          <nomo>
            .Set
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                24
              </lid>
              <msid>
                ""
              </msid>
            </listen> <listen>
              <chan>
                x
              </chan>
              <vars>
                c , d
              </vars>
              <num>
                2
              </num>
              <lid>
                25
              </lid>
              <msid>
                ""
              </msid>
            </listen>
          </listens>
        </rec>
      </receives>
    </tuplespace>
    <reaction>
      <who>
        peek ! ( * a , * b )
      </who>
      <what>
        ""
      </what>
      <where>
        ""
      </where>
      <rid>
        4
      </rid>
      <rnum>
        0
      </rnum>
      <react>
        "collect"
      </react>
      <forg>
        .Set
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            SetItem ( 3 )
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            16
          </sid>
          <mlid>
            SetItem ( 24 )
          </mlid>
        </send>
      </sends>
      <receives>
        <rec>
          <id>
            4
          </id>
          <length>
            1
          </length>
          <cont>
            peek ! ( * a , * b )
          </cont>
          <state>
            "collection"
          </state>
          <match>
            1
          </match>
          <type>
            2
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                3
              </lid>
              <msid>
                21
              </msid>
            </listen>
          </listens>
        </rec> <rec>
          <id>
            10
          </id>
          <length>
            2
          </length>
          <cont>
            linear ! ( * a , * c )
          </cont>
          <state>
            ""
          </state>
          <match>
            1
          </match>
          <type>
            0
          </type>
          <nomo>
            SetItem ( 16 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                24
              </lid>
              <msid>
                16
              </msid>
            </listen> <listen>
              <chan>
                x
              </chan>
              <vars>
                c , d
              </vars>
              <num>
                2
              </num>
              <lid>
                25
              </lid>
              <msid>
                ""
              </msid>
            </listen>
          </listens>
        </rec>
      </receives>
    </tuplespace>
    <reaction>
      <who>
        peek ! ( * a , * b )
      </who>
      <what>
        ""
      </what>
      <where>
        ""
      </where>
      <rid>
        4
      </rid>
      <rnum>
        0
      </rnum>
      <react>
        "collect"
      </react>
      <forg>
        .Set
      </forg>
    </reaction>
  </T>
#Or
  Result ==K <T>
    <threads>
      .ThreadCellBag
    </threads>
    <tuplespace>
      <sends>
        <send>
          <schan>
            x
          </schan>
          <msg>
            1 , 1
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            1
          </stype>
          <sid>
            21
          </sid>
          <mlid>
            SetItem ( 3 )
          </mlid>
        </send> <send>
          <schan>
            x
          </schan>
          <msg>
            2 , 2
          </msg>
          <tuple>
            2
          </tuple>
          <stype>
            0
          </stype>
          <sid>
            16
          </sid>
          <mlid>
            SetItem ( 25 )
          </mlid>
        </send>
      </sends>
      <receives>
        <rec>
          <id>
            4
          </id>
          <length>
            1
          </length>
          <cont>
            peek ! ( * a , * b )
          </cont>
          <state>
            "collection"
          </state>
          <match>
            1
          </match>
          <type>
            2
          </type>
          <nomo>
            SetItem ( 21 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                3
              </lid>
              <msid>
                21
              </msid>
            </listen>
          </listens>
        </rec> <rec>
          <id>
            10
          </id>
          <length>
            2
          </length>
          <cont>
            linear ! ( * a , * c )
          </cont>
          <state>
            ""
          </state>
          <match>
            1
          </match>
          <type>
            0
          </type>
          <nomo>
            SetItem ( 16 )
          </nomo>
          <listens>
            <listen>
              <chan>
                x
              </chan>
              <vars>
                a , b
              </vars>
              <num>
                2
              </num>
              <lid>
                24
              </lid>
              <msid>
                ""
              </msid>
            </listen> <listen>
              <chan>
                x
              </chan>
              <vars>
                c , d
              </vars>
              <num>
                2
              </num>
              <lid>
                25
              </lid>
              <msid>
                16
              </msid>
            </listen>
          </listens>
        </rec>
      </receives>
    </tuplespace>
    <reaction>
      <who>
        peek ! ( * a , * b )
      </who>
      <what>
        ""
      </what>
      <where>
        ""
      </where>
      <rid>
        4
      </rid>
      <rnum>
        0
      </rnum>
      <react>
        "collect"
      </react>
      <forg>
        .Set
      </forg>
    </reaction>
  </T>
*/